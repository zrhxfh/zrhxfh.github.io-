<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<title>手机AI聊天</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
<style>
:root{--bg:#0d1117;--panel:#161b22;--primary:#58a6ff;--sub:#8b949e;--msg:#21262d;--me:#1f4e79;--bot:#30363d;--radius:18px;--shadow:0 8px 32px rgba(0,0,0,.3);}
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;}
body{height:100vh;display:flex;flex-direction:column;background:var(--bg);color:#f0f6fc;}

/* ===== 密码锁 ===== */
#lockScreen{position:fixed;inset:0;background:linear-gradient(135deg,#0d1117 0%,#010409 100%);display:flex;align-items:center;justify-content:center;z-index:9999;}
#lockBox{background:var(--panel);padding:40px 30px;border-radius:var(--radius);box-shadow:var(--shadow);width:300px;text-align:center;}
#lockBox h3{margin-bottom:20px;font-size:22px;font-weight:600;letter-spacing:.5px;}
#lockBox input{width:100%;padding:12px 16px;border:1px solid var(--sub);border-radius:12px;background:var(--msg);color:#fff;font-size:16px;transition:.3s;}
#lockBox input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(88,166,255,.25);}
#lockBox button{width:100%;margin-top:16px;padding:12px;border:none;border-radius:12px;background:var(--primary);color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:.3s;}
#lockBox button:hover{background:#79c0ff;}
#lockBox .error{color:#f85149;font-size:14px;margin-top:8px;height:18px;}

/* ===== 聊天界面 ===== */
#chatBox{display:none;height:100vh;display:flex;flex-direction:column;background:var(--bg);}
header{padding:12px 20px;background:var(--panel);box-shadow:0 2px 8px rgba(0,0,0,.2);display:flex;align-items:center;gap:12px;}
header h3{font-size:18px;font-weight:600;}
#modelSel{background:var(--msg);color:#fff;border:1px solid var(--sub);border-radius:8px;padding:4px 8px;font-size:14px;margin-left:auto;}
#log{flex:1;padding:16px 12px;overflow-y:auto;display:flex;flex-direction:column;gap:10px;}
.msg{max-width:78%;padding:10px 14px;border-radius:var(--radius);line-height:1.4;font-size:15px;word-break:break-word;animation:fade .3s ease;}
.me{align-self:flex-end;background:var(--me);color:#fff;}
.bot{align-self:flex-start;background:var(--bot);}
@keyframes fade{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
#inputBar{padding:12px;background:var(--panel);display:flex;gap:10px;align-items:center;border-top:1px solid var(--sub);}
#in{flex:1;padding:12px 16px;border:1px solid var(--sub);border-radius:20px;background:var(--msg);color:#fff;font-size:15px;transition:.3s;}
#in:focus{outline:none;border-color:var(--primary);}
#send{width:40px;height:40px;border:none;border-radius:50%;background:var(--primary);color:#fff;font-size:18px;cursor:pointer;transition:.3s;display:grid;place-items:center;}
#send:hover{background:#79c0ff;transform:scale(1.05);}
.time{font-size:11px;color:var(--sub);margin-top:4px;text-align:right;}
</style>
</head>
<body>

<!-- === 密码锁 === -->
<div id="lockScreen">
  <div id="lockBox">
    <h3>AI 聊天解锁</h3>
    <input type="password" id="pwdInput" placeholder="输入密码" />
    <button onclick="checkPwd()">解锁</button>
    <div id="err" class="error"></div>
  </div>
</div>

<!-- === 聊天界面 === -->
<div id="chatBox">
  <header>
    <h3>AI 聊天</h3>
    <select id="modelSel">
      <option value="deepseek-r1:1.5b">DeepSeek-r1:1.5b</option>
      <option value="xiaoli">dolphin-mistral:7b（小璃）</option>
      <option value="yeli">Llama2-Uncensored:7b（夜璃）</option>
    </select>
  </header>
  <div id="log"></div>
  <div id="inputBar">
    <input id="in" placeholder="输入问题回车发送" />
    <button id="send" onclick="send()">➤</button>
  </div>
</div>

<script>
/* ========== 密码锁 ========== */
const PASSWORD = '1234'; // ← 修改密码
function checkPwd(){
  const v = document.getElementById('pwdInput').value;
  if(v === PASSWORD){
    document.getElementById('lockScreen').style.display='none';
    document.getElementById('chatBox').style.display='flex';
    document.getElementById('in').focus();
  }else{
    document.getElementById('err').textContent='密码错误';
  }
}

/* ========== 聊天核心 ========== */
const baseURL = 'http://5.tcp.cpolar.top:10000'; // 当前活隧道
const log = document.getElementById('log');
function print(html,cls='bot'){
  const div=document.createElement('div');div.className='msg ' + cls;div.innerHTML=html;log.appendChild(div);log.scrollTop=log.scrollHeight;
}
function time(){const d=new Date();return d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0');}

async function send(){
  const q=document.getElementById('in').value.trim();if(!q)return;
  const model=document.getElementById('modelSel').value;
  print(`<div>${q}</div><div class="time">${time()}</div>`,'me');document.getElementById('in').value='';
  try{
    const res=await fetch(baseURL+'/api/generate',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({model:model,prompt:q,stream:false})
    });
    const d=await res.json();
    print(`<div>${d.response.trim()}</div><div class="time">${time()}</div>`,'bot');
  }catch(e){print(`<div style="color:#f85149">出错：${e}</div>`,'bot');}
}
document.getElementById('in').addEventListener('keyup',e=>{if(e.key==='Enter')send();});
</script>
</body>
</html>
